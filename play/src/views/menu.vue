<template>
  <div class="layout">
    <div class="sidebar">
      <MYMenu :default-active="activeIndex" :default-openeds="defaultOpeneds" :collapse="isCollapse"
        :unique-opened="true" @select="handleSelect" @open="handleMenuOpen" @close="handleMenuClose">
        <!-- å®Œæ•´çš„èœå•ç»“æ„ -->
        <MYMenu-item index="1">
          <template #icon>
            <i class="icon-home"></i>
          </template>
          é¦–é¡µ
        </MYMenu-item>

        <MYMenu-submenu index="2">
          <template #icon>
            <i class="icon-user"></i>
          </template>
          <template #title>ç”¨æˆ·ç®¡ç†</template>
          <MYMenu-item index="2-1">ç”¨æˆ·åˆ—è¡¨</MYMenu-item>
          <MYMenu-item index="2-2">ç”¨æˆ·ç»„</MYMenu-item>

          <!-- ä¸‰çº§èœå• -->
          <MYMenu-submenu index="2-3">
            <template #title>æƒé™ç®¡ç†</template>
            <MYMenu-item index="2-3-1">è§’è‰²æƒé™</MYMenu-item>
            <MYMenu-item index="2-3-2">æ•°æ®æƒé™</MYMenu-item>
            <MYMenu-item index="2-3-3">æ“ä½œæƒé™</MYMenu-item>
          </MYMenu-submenu>

          <MYMenu-item index="2-4">ç™»å½•æ—¥å¿—</MYMenu-item>
        </MYMenu-submenu>

        <MYMenu-submenu index="3">
          <template #icon>
            <i class="icon-product"></i>
          </template>
          <template #title>å•†å“ç®¡ç†</template>
          <MYMenu-item index="3-1">å•†å“åˆ—è¡¨</MYMenu-item>
          <MYMenu-item index="3-2">å•†å“åˆ†ç±»</MYMenu-item>

          <!-- ä¸‰çº§èœå• -->
          <MYMenu-submenu index="3-3">
            <template #title>åº“å­˜ç®¡ç†</template>
            <MYMenu-item index="3-3-1">åº“å­˜æŸ¥è¯¢</MYMenu-item>
            <MYMenu-item index="3-3-2">å…¥åº“ç®¡ç†</MYMenu-item>
            <MYMenu-item index="3-3-3">å‡ºåº“ç®¡ç†</MYMenu-item>

            <!-- å››çº§èœå• -->
            <MYMenu-submenu index="3-3-4">
              <template #title>åº“å­˜é¢„è­¦</template>
              <MYMenu-item index="3-3-4-1">é¢„è­¦è®¾ç½®</MYMenu-item>
              <MYMenu-item index="3-3-4-2">é¢„è­¦è®°å½•</MYMenu-item>
            </MYMenu-submenu>
          </MYMenu-submenu>

          <MYMenu-item index="3-4">å•†å“è¯„ä»·</MYMenu-item>
        </MYMenu-submenu>

        <MYMenu-submenu index="4">
          <template #icon>
            <i class="icon-order"></i>
          </template>
          <template #title>è®¢å•ç®¡ç†</template>
          <MYMenu-item index="4-1">è®¢å•åˆ—è¡¨</MYMenu-item>

          <!-- ä¸‰çº§èœå• -->
          <MYMenu-submenu index="4-2">
            <template #title>é€€æ¬¾ç®¡ç†</template>
            <MYMenu-item index="4-2-1">é€€æ¬¾ç”³è¯·</MYMenu-item>
            <MYMenu-item index="4-2-2">é€€æ¬¾å¤„ç†</MYMenu-item>
            <MYMenu-item index="4-2-3">é€€æ¬¾è®°å½•</MYMenu-item>
          </MYMenu-submenu>

          <MYMenu-submenu index="4-3">
            <template #title>ç‰©æµç®¡ç†</template>
            <MYMenu-item index="4-3-1">å‘è´§ç®¡ç†</MYMenu-item>
            <MYMenu-item index="4-3-2">ç‰©æµè·Ÿè¸ª</MYMenu-item>
          </MYMenu-submenu>
        </MYMenu-submenu>

        <MYMenu-submenu index="5">
          <template #icon>
            <i class="icon-system"></i>
          </template>
          <template #title>ç³»ç»Ÿè®¾ç½®</template>
          <MYMenu-item index="5-1">åŸºç¡€è®¾ç½®</MYMenu-item>

          <!-- ä¸‰çº§èœå• -->
          <MYMenu-submenu index="5-2">
            <template #title>å®‰å…¨ç®¡ç†</template>
            <MYMenu-item index="5-2-1">å¯†ç ç­–ç•¥</MYMenu-item>
            <MYMenu-item index="5-2-2">æ“ä½œæ—¥å¿—</MYMenu-item>
            <MYMenu-item index="5-2-3">å®‰å…¨å®¡è®¡</MYMenu-item>
          </MYMenu-submenu>

          <MYMenu-submenu index="5-3">
            <template #title>é€šçŸ¥è®¾ç½®</template>
            <MYMenu-item index="5-3-1">é‚®ä»¶é€šçŸ¥</MYMenu-item>
            <MYMenu-item index="5-3-2">çŸ­ä¿¡é€šçŸ¥</MYMenu-item>
          </MYMenu-submenu>
        </MYMenu-submenu>

        <MYMenu-submenu index="6">
          <template #icon>
            <i class="icon-data"></i>
          </template>
          <template #title>æ•°æ®ä¸­å¿ƒ</template>
          <MYMenu-item index="6-1">æ•°æ®ç»Ÿè®¡</MYMenu-item>
          <MYMenu-item index="6-2">æŠ¥è¡¨åˆ†æ</MYMenu-item>

          <!-- ä¸‰çº§èœå• -->
          <MYMenu-submenu index="6-3">
            <template #title>æ•°æ®å¯è§†åŒ–</template>
            <MYMenu-item index="6-3-1">å›¾è¡¨å±•ç¤º</MYMenu-item>
            <MYMenu-item index="6-3-2">æ•°æ®å¤§å±</MYMenu-item>
          </MYMenu-submenu>
        </MYMenu-submenu>

        <MYMenu-submenu index="7">
          <template #icon>
            <i class="icon-finance"></i>
          </template>
          <template #title>è´¢åŠ¡ç®¡ç†</template>
          <MYMenu-item index="7-1">æ”¶å…¥ç»Ÿè®¡</MYMenu-item>
          <MYMenu-item index="7-2">æ”¯å‡ºç®¡ç†</MYMenu-item>

          <!-- ä¸‰çº§èœå• -->
          <MYMenu-submenu index="7-3">
            <template #title>è´¢åŠ¡æŠ¥è¡¨</template>
            <MYMenu-item index="7-3-1">åˆ©æ¶¦è¡¨</MYMenu-item>
            <MYMenu-item index="7-3-2">èµ„äº§è´Ÿå€ºè¡¨</MYMenu-item>
            <MYMenu-item index="7-3-3">ç°é‡‘æµé‡è¡¨</MYMenu-item>
          </MYMenu-submenu>
        </MYMenu-submenu>

        <MYMenu-item index="8" disabled>
          <template #icon>
            <i class="icon-help"></i>
          </template>
          å¸®åŠ©ä¸­å¿ƒ
        </MYMenu-item>
      </MYMenu>
    </div>

    <div class="main-content">
      <div class="header">
        <button @click="toggleCollapse" class="collapse-btn">
          {{ isCollapse ? 'å±•å¼€' : 'æŠ˜å ' }}
        </button>
        <h2>å½“å‰æ¿€æ´»èœå•: {{ activeIndex }}</h2>
        <span class="menu-path">èœå•è·¯å¾„: {{ currentPath }}</span>
        <div class="control-buttons">
          <button @click="toggleUniqueOpened" class="unique-btn">
            {{ uniqueOpened ? 'å…³é—­å”¯ä¸€å±•å¼€' : 'å¼€å¯å”¯ä¸€å±•å¼€' }}
          </button>
          <button @click="forceRefresh" class="refresh-btn">å¼ºåˆ¶åˆ·æ–°çŠ¶æ€</button>
          <button @click="clearStorage" class="clear-btn">æ¸…é™¤å­˜å‚¨</button>
        </div>
      </div>

      <div class="content">
        <div class="welcome">
          <h1>æ¬¢è¿ä½¿ç”¨ MYMenu ç»„ä»¶åº“</h1>
          <p>å½“å‰æ¿€æ´»èœå•: {{ activeIndex }}</p>
          <p>å½“å‰å±•å¼€çš„èœå•: {{ JSON.stringify(defaultOpeneds) }}</p>
          <p>å”¯ä¸€å±•å¼€æ¨¡å¼: {{ uniqueOpened ? 'å¼€å¯' : 'å…³é—­' }}</p>
        </div>

        <div class="test-info">
          <h3>åŠŸèƒ½éªŒè¯:</h3>
          <ul>
            <li>âœ… æ”¯æŒæ— é™çº§åµŒå¥—èœå•</li>
            <li>âœ… ç‚¹å‡»èœå•é¡¹ä¸ä¼šæŠ˜å å·²å±•å¼€çš„ submenu</li>
            <li :class="{ 'feature-testing': true, 'feature-pass': uniqueOpenedTestPassed }">
              {{ uniqueOpenedTestPassed ? 'âœ…' : 'ğŸ”„' }}
              ç‚¹å‡»ä¸åŒ submenu æ—¶ï¼Œå‰ä¸€ä¸ª submenu ä¼šè‡ªåŠ¨æŠ˜å  (unique-opened)
            </li>
            <li>âœ… å±•å¼€ submenu åç‚¹å‡»å…¶ä¸­çš„èœå•é¡¹ï¼Œsubmenu ä¿æŒå±•å¼€çŠ¶æ€</li>
            <li>âœ… ä¸‰çº§ã€å››çº§èœå•æ­£å¸¸æ˜¾ç¤ºå’Œäº¤äº’</li>
            <li>âœ… æŠ˜å çŠ¶æ€ä¸‹æµ®å±‚èœå•æ­£å¸¸æ˜¾ç¤º</li>
            <li>âœ… èœå•æ¿€æ´»çŠ¶æ€æ­£ç¡®æ˜¾ç¤º</li>
            <li>âœ… åˆ·æ–°åä¿æŒèœå•å±•å¼€çŠ¶æ€</li>
            <li>âœ… åˆ·æ–°åä¿æŒæ¿€æ´»èœå•çŠ¶æ€</li>
          </ul>
        </div>

        <div class="usage-tips">
          <h3>ä½¿ç”¨æç¤º:</h3>
          <div class="tips-grid">
            <div class="tip-card">
              <h4>ğŸ” æµ‹è¯•ä¸‰çº§èœå•</h4>
              <p>ç‚¹å‡»"å•†å“ç®¡ç†" â†’ "åº“å­˜ç®¡ç†" â†’ "åº“å­˜é¢„è­¦" æŸ¥çœ‹å¤šçº§èœå•æ•ˆæœ</p>
            </div>
            <div class="tip-card">
              <h4>ğŸ”„ æµ‹è¯• unique-opened</h4>
              <p>å¼€å¯å”¯ä¸€å±•å¼€æ¨¡å¼ï¼Œç‚¹å‡»"ç”¨æˆ·ç®¡ç†"ï¼Œç„¶åç‚¹å‡»"å•†å“ç®¡ç†"ï¼Œè§‚å¯Ÿç”¨æˆ·ç®¡ç†æ˜¯å¦è‡ªåŠ¨æŠ˜å </p>
            </div>
            <div class="tip-card">
              <h4>ğŸ“± æµ‹è¯•æŠ˜å æ¨¡å¼</h4>
              <p>ç‚¹å‡»"æŠ˜å "æŒ‰é’®æŸ¥çœ‹èœå•åœ¨æ”¶èµ·çŠ¶æ€ä¸‹çš„æ‚¬æµ®æ•ˆæœ</p>
            </div>
            <div class="tip-card">
              <h4>ğŸ¯ æµ‹è¯•æ¿€æ´»çŠ¶æ€</h4>
              <p>ç‚¹å‡»ä¸åŒå±‚çº§çš„èœå•é¡¹ï¼Œè§‚å¯Ÿæ¿€æ´»çŠ¶æ€æ˜¯å¦æ­£ç¡®ä¼ é€’</p>
            </div>
            <div class="tip-card">
              <h4>ğŸ’¾ æµ‹è¯•çŠ¶æ€æŒä¹…åŒ–</h4>
              <p>å±•å¼€èœå•å¹¶é€‰æ‹©æŸä¸ªèœå•é¡¹ï¼Œåˆ·æ–°é¡µé¢æŸ¥çœ‹çŠ¶æ€æ˜¯å¦ä¿æŒ</p>
            </div>
            <div class="tip-card">
              <h4>ğŸ”„ æµ‹è¯•å¼ºåˆ¶åˆ·æ–°</h4>
              <p>ä½¿ç”¨"å¼ºåˆ¶åˆ·æ–°çŠ¶æ€"æŒ‰é’®è°ƒè¯•çŠ¶æ€æ¢å¤é—®é¢˜</p>
            </div>
          </div>
        </div>

        <div class="debug-info">
          <h3>è°ƒè¯•ä¿¡æ¯:</h3>
          <div class="debug-content">
            <p><strong>localStorage çŠ¶æ€:</strong></p>
            <pre>{{ localStorageState }}</pre>
            <p><strong>å½“å‰ç»„ä»¶çŠ¶æ€:</strong></p>
            <pre>{{ componentState }}</pre>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, watch } from 'vue'

const activeIndex = ref('1')
const isCollapse = ref(false)
const uniqueOpened = ref(true)
const uniqueOpenedTestPassed = ref(false)

// ä» localStorage åŠ è½½ä¿å­˜çš„çŠ¶æ€
const loadMenuState = () => {
  try {
    const savedActive = localStorage.getItem('test_menu_activeIndex')
    const savedOpeneds = localStorage.getItem('test_menu_openeds')

    console.log('ğŸ” æµ‹è¯•ä»£ç ï¼šä»localStorageåŠ è½½èœå•çŠ¶æ€:')
    console.log('  - activeIndex:', savedActive)
    console.log('  - openedMenus:', savedOpeneds)

    if (savedActive) {
      activeIndex.value = savedActive
    }

    if (savedOpeneds) {
      const parsed = JSON.parse(savedOpeneds)
      console.log('âœ… æµ‹è¯•ä»£ç ï¼šè§£æåçš„èœå•çŠ¶æ€:', parsed)
      return parsed
    }
  } catch (error) {
    console.error('æµ‹è¯•ä»£ç ï¼šåŠ è½½èœå•å±•å¼€çŠ¶æ€å¤±è´¥:', error)
  }
  return []
}

const defaultOpeneds = ref<string[]>(loadMenuState())

// ä¿å­˜æ‰€æœ‰çŠ¶æ€åˆ° localStorage
const saveMenuState = () => {
  try {
    console.log('ğŸ’¾ æµ‹è¯•ä»£ç ï¼šä¿å­˜èœå•çŠ¶æ€åˆ°localStorage:')
    console.log('  - activeIndex:', activeIndex.value)
    console.log('  - openedMenus:', defaultOpeneds.value)

    localStorage.setItem('test_menu_activeIndex', activeIndex.value)
    localStorage.setItem('test_menu_openeds', JSON.stringify(defaultOpeneds.value))
  } catch (error) {
    console.error('æµ‹è¯•ä»£ç ï¼šä¿å­˜èœå•çŠ¶æ€å¤±è´¥:', error)
  }
}

// ç›‘å¬çŠ¶æ€å˜åŒ–å¹¶ä¿å­˜
watch([activeIndex, defaultOpeneds], () => {
  saveMenuState()
}, { deep: true })

// ç›‘å¬ uniqueOpened å˜åŒ–ï¼Œæµ‹è¯•åŠŸèƒ½
watch(defaultOpeneds, (newOpeneds, oldOpeneds) => {
  if (uniqueOpened.value && newOpeneds.length === 1 && oldOpeneds && oldOpeneds.length > 0) {
    uniqueOpenedTestPassed.value = true
    console.log('âœ… unique-opened åŠŸèƒ½æµ‹è¯•é€šè¿‡')
  }
}, { deep: true })

// ä¿®æ”¹èœå•å±•å¼€å¤„ç†é€»è¾‘
const handleMenuOpen = (key: string, keyPath: string[]) => {
  console.log('ğŸ“‚ æµ‹è¯•ä»£ç ï¼šèœå•å±•å¼€ - key:', key, 'keyPath:', keyPath)

  if (uniqueOpened.value) {
    // åœ¨ unique-opened æ¨¡å¼ä¸‹ï¼Œåªä¿ç•™å½“å‰å±•å¼€çš„èœå•åŠå…¶çˆ¶çº§èœå•
    const newOpeneds = [...keyPath] // keyPath åŒ…å«ä»å½“å‰èœå•åˆ°æ ¹èœå•çš„æ‰€æœ‰ç´¢å¼•

    // è¿‡æ»¤æ‰éç›´æ¥ç›¸å…³çš„èœå•ï¼Œåªä¿ç•™å½“å‰å±•å¼€è·¯å¾„çš„èœå•
    defaultOpeneds.value = newOpeneds.filter(menuKey => {
      // ä¿ç•™å½“å‰èœå•çš„æ‰€æœ‰çˆ¶çº§èœå•
      return keyPath.includes(menuKey)
    })
  } else {
    // é unique-opened æ¨¡å¼ï¼Œä½¿ç”¨åŸæœ‰é€»è¾‘
    if (!defaultOpeneds.value.includes(key)) {
      defaultOpeneds.value.push(key)
    }
  }
}

const handleMenuClose = (key: string, keyPath: string[]) => {
  console.log('ğŸ“ æµ‹è¯•ä»£ç ï¼šèœå•å…³é—­ - key:', key, 'keyPath:', keyPath)

  if (uniqueOpened.value) {
    // åœ¨ unique-opened æ¨¡å¼ä¸‹ï¼Œå…³é—­èœå•æ—¶éœ€è¦ç‰¹æ®Šå¤„ç†
    // ç§»é™¤å½“å‰èœå•åŠå…¶æ‰€æœ‰å­èœå•
    const closeMenuAndChildren = (menuKey: string) => {
      const index = defaultOpeneds.value.indexOf(menuKey)
      if (index > -1) {
        defaultOpeneds.value.splice(index, 1)
      }

      // é€’å½’ç§»é™¤æ‰€æœ‰å­èœå•
      defaultOpeneds.value.forEach((openedKey, idx) => {
        if (openedKey.startsWith(menuKey + '-')) {
          defaultOpeneds.value.splice(idx, 1)
        }
      })
    }

    closeMenuAndChildren(key)
  } else {
    // é unique-opened æ¨¡å¼ï¼Œä½¿ç”¨åŸæœ‰é€»è¾‘
    const index = defaultOpeneds.value.indexOf(key)
    if (index > -1) {
      defaultOpeneds.value.splice(index, 1)
    }
  }
}

// ä¿®æ”¹èœå•é€‰æ‹©å¤„ç†ï¼Œç¡®ä¿æ¿€æ´»çŠ¶æ€æ­£ç¡®
const handleSelect = (index: string, indexPath: string[]) => {
  console.log('é€‰ä¸­èœå•:', index, 'å®Œæ•´è·¯å¾„:', indexPath)
  activeIndex.value = index

  if (uniqueOpened.value) {
    // åœ¨é€‰æ‹©èœå•æ—¶ï¼Œç¡®ä¿å…¶æ‰€æœ‰çˆ¶çº§èœå•éƒ½æ˜¯å±•å¼€çŠ¶æ€
    const parentMenus = indexPath.slice(0, -1) // ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆå½“å‰èœå•ï¼‰
    defaultOpeneds.value = Array.from(new Set([...defaultOpeneds.value, ...parentMenus]))
  }
}

// å…¶ä»–æ–¹æ³•ä¿æŒä¸å˜...
const toggleCollapse = () => {
  isCollapse.value = !isCollapse.value
}

const toggleUniqueOpened = () => {
  uniqueOpened.value = !uniqueOpened.value
  uniqueOpenedTestPassed.value = false

  // åˆ‡æ¢æ¨¡å¼æ—¶é‡ç½®å±•å¼€çŠ¶æ€
  if (uniqueOpened.value) {
    // åœ¨å¼€å¯ unique-opened æ—¶ï¼Œåªä¿ç•™æ¿€æ´»èœå•çš„è·¯å¾„
    const activePath = getActiveMenuPath(activeIndex.value)
    defaultOpeneds.value = activePath
  }
  console.log('ğŸ”„ uniqueOpened æ¨¡å¼:', uniqueOpened.value ? 'å¼€å¯' : 'å…³é—­')
}

// è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®æ¿€æ´»èœå•ç´¢å¼•è·å–å…¶è·¯å¾„
const getActiveMenuPath = (index: string): string[] => {
  const path: string[] = []
  const parts = index.split('-')

  for (let i = 1; i <= parts.length; i++) {
    path.push(parts.slice(0, i).join('-'))
  }

  return path.slice(0, -1) // ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆå½“å‰æ¿€æ´»çš„èœå•é¡¹ï¼‰
}

// å¼ºåˆ¶åˆ·æ–°çŠ¶æ€ï¼ˆç”¨äºè°ƒè¯•ï¼‰
const forceRefresh = () => {
  console.log('ğŸ”„ å¼ºåˆ¶åˆ·æ–°çŠ¶æ€')
  const currentOpeneds = [...defaultOpeneds.value]
  const currentActive = activeIndex.value

  // å…ˆæ¸…ç©ºçŠ¶æ€
  defaultOpeneds.value = []
  activeIndex.value = '1'

  // ç„¶åæ¢å¤çŠ¶æ€
  setTimeout(() => {
    defaultOpeneds.value = currentOpeneds
    activeIndex.value = currentActive
    console.log('âœ… çŠ¶æ€åˆ·æ–°å®Œæˆ:')
    console.log('  - openedMenus:', defaultOpeneds.value)
    console.log('  - activeIndex:', activeIndex.value)
  }, 100)
}

// æ¸…é™¤ localStorage
const clearStorage = () => {
  localStorage.removeItem('test_menu_activeIndex')
  localStorage.removeItem('test_menu_openeds')
  activeIndex.value = '1'
  defaultOpeneds.value = []
  uniqueOpenedTestPassed.value = false
  console.log('ğŸ—‘ï¸ å·²æ¸…é™¤ localStorage çŠ¶æ€')
}

// æ¨¡æ‹Ÿæ ¹æ®æ¿€æ´»ç´¢å¼•æ˜¾ç¤ºè·¯å¾„
const currentPath = computed(() => {
  const pathMap: Record<string, string> = {
    '1': 'é¦–é¡µ',
    '2-1': 'ç”¨æˆ·ç®¡ç† / ç”¨æˆ·åˆ—è¡¨',
    '2-2': 'ç”¨æˆ·ç®¡ç† / ç”¨æˆ·ç»„',
    '2-3-1': 'ç”¨æˆ·ç®¡ç† / æƒé™ç®¡ç† / è§’è‰²æƒé™',
    '2-3-2': 'ç”¨æˆ·ç®¡ç† / æƒé™ç®¡ç† / æ•°æ®æƒé™',
    '2-3-3': 'ç”¨æˆ·ç®¡ç† / æƒé™ç®¡ç† / æ“ä½œæƒé™',
    '2-4': 'ç”¨æˆ·ç®¡ç† / ç™»å½•æ—¥å¿—',
    '3-1': 'å•†å“ç®¡ç† / å•†å“åˆ—è¡¨',
    '3-2': 'å•†å“ç®¡ç† / å•†å“åˆ†ç±»',
    '3-3-1': 'å•†å“ç®¡ç† / åº“å­˜ç®¡ç† / åº“å­˜æŸ¥è¯¢',
    '3-3-2': 'å•†å“ç®¡ç† / åº“å­˜ç®¡ç† / å…¥åº“ç®¡ç†',
    '3-3-3': 'å•†å“ç®¡ç† / åº“å­˜ç®¡ç† / å‡ºåº“ç®¡ç†',
    '3-3-4-1': 'å•†å“ç®¡ç† / åº“å­˜ç®¡ç† / åº“å­˜é¢„è­¦ / é¢„è­¦è®¾ç½®',
    '3-3-4-2': 'å•†å“ç®¡ç† / åº“å­˜ç®¡ç† / åº“å­˜é¢„è­¦ / é¢„è­¦è®°å½•',
    '3-4': 'å•†å“ç®¡ç† / å•†å“è¯„ä»·',
    '4-1': 'è®¢å•ç®¡ç† / è®¢å•åˆ—è¡¨',
    '4-2-1': 'è®¢å•ç®¡ç† / é€€æ¬¾ç®¡ç† / é€€æ¬¾ç”³è¯·',
    '4-2-2': 'è®¢å•ç®¡ç† / é€€æ¬¾ç®¡ç† / é€€æ¬¾å¤„ç†',
    '4-2-3': 'è®¢å•ç®¡ç† / é€€æ¬¾ç®¡ç† / é€€æ¬¾è®°å½•',
    '4-3-1': 'è®¢å•ç®¡ç† / ç‰©æµç®¡ç† / å‘è´§ç®¡ç†',
    '4-3-2': 'è®¢å•ç®¡ç† / ç‰©æµç®¡ç† / ç‰©æµè·Ÿè¸ª',
    '5-1': 'ç³»ç»Ÿè®¾ç½® / åŸºç¡€è®¾ç½®',
    '5-2-1': 'ç³»ç»Ÿè®¾ç½® / å®‰å…¨ç®¡ç† / å¯†ç ç­–ç•¥',
    '5-2-2': 'ç³»ç»Ÿè®¾ç½® / å®‰å…¨ç®¡ç† / æ“ä½œæ—¥å¿—',
    '5-2-3': 'ç³»ç»Ÿè®¾ç½® / å®‰å…¨ç®¡ç† / å®‰å…¨å®¡è®¡',
    '5-3-1': 'ç³»ç»Ÿè®¾ç½® / é€šçŸ¥è®¾ç½® / é‚®ä»¶é€šçŸ¥',
    '5-3-2': 'ç³»ç»Ÿè®¾ç½® / é€šçŸ¥è®¾ç½® / çŸ­ä¿¡é€šçŸ¥',
    '6-1': 'æ•°æ®ä¸­å¿ƒ / æ•°æ®ç»Ÿè®¡',
    '6-2': 'æ•°æ®ä¸­å¿ƒ / æŠ¥è¡¨åˆ†æ',
    '6-3-1': 'æ•°æ®ä¸­å¿ƒ / æ•°æ®å¯è§†åŒ– / å›¾è¡¨å±•ç¤º',
    '6-3-2': 'æ•°æ®ä¸­å¿ƒ / æ•°æ®å¯è§†åŒ– / æ•°æ®å¤§å±',
    '7-1': 'è´¢åŠ¡ç®¡ç† / æ”¶å…¥ç»Ÿè®¡',
    '7-2': 'è´¢åŠ¡ç®¡ç† / æ”¯å‡ºç®¡ç†',
    '7-3-1': 'è´¢åŠ¡ç®¡ç† / è´¢åŠ¡æŠ¥è¡¨ / åˆ©æ¶¦è¡¨',
    '7-3-2': 'è´¢åŠ¡ç®¡ç† / è´¢åŠ¡æŠ¥è¡¨ / èµ„äº§è´Ÿå€ºè¡¨',
    '7-3-3': 'è´¢åŠ¡ç®¡ç† / è´¢åŠ¡æŠ¥è¡¨ / ç°é‡‘æµé‡è¡¨'
  }
  return pathMap[activeIndex.value] || activeIndex.value
})

// è°ƒè¯•ä¿¡æ¯
const localStorageState = computed(() => {
  return {
    activeIndex: localStorage.getItem('test_menu_activeIndex'),
    openedMenus: localStorage.getItem('test_menu_openeds')
  }
})

const componentState = computed(() => {
  return {
    activeIndex: activeIndex.value,
    openedMenus: defaultOpeneds.value,
    uniqueOpened: uniqueOpened.value
  }
})

onMounted(() => {
  console.log('ğŸ”„ æµ‹è¯•ä»£ç ï¼šç»„ä»¶æŒ‚è½½')
  console.log('  - activeIndex:', activeIndex.value)
  console.log('  - defaultOpeneds:', defaultOpeneds.value)
  console.log('  - uniqueOpened:', uniqueOpened.value)
})
</script>
<style scoped>
.layout {
  display: flex;
  height: 100vh;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.sidebar {
  width: auto;
  background: #2f3b46;
}

.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: #f5f7fa;
}

.header {
  padding: 16px 24px;
  background: white;
  border-bottom: 1px solid #e4e7ed;
  display: flex;
  align-items: center;
  gap: 16px;
}

.header h2 {
  margin: 0;
  font-size: 18px;
  color: #303133;
}

.menu-path {
  margin-left: auto;
  color: #909399;
  font-size: 14px;
}

.control-buttons {
  display: flex;
  gap: 8px;
  margin-left: 16px;
}

.collapse-btn {
  padding: 8px 16px;
  background: #409EFF;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.collapse-btn:hover {
  background: #66b1ff;
}

.unique-btn {
  padding: 8px 16px;
  background: #E6A23C;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.unique-btn:hover {
  background: #eebe77;
}

.refresh-btn {
  padding: 8px 16px;
  background: #67C23A;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.refresh-btn:hover {
  background: #85ce61;
}

.clear-btn {
  padding: 8px 16px;
  background: #F56C6C;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.clear-btn:hover {
  background: #f78989;
}

.content {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
}

.welcome {
  text-align: center;
  margin-bottom: 32px;
  padding: 40px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.welcome h1 {
  color: #303133;
  margin-bottom: 16px;
}

.welcome p {
  color: #606266;
  font-size: 16px;
  margin: 8px 0;
}

.test-info {
  margin-bottom: 24px;
  padding: 20px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.test-info h3 {
  color: #303133;
  margin-bottom: 16px;
}

.test-info ul {
  margin: 0;
  padding-left: 20px;
}

.test-info li {
  margin: 8px 0;
  font-size: 14px;
}

.test-info .feature-pass {
  color: #67C23A;
}

.test-info .feature-testing {
  color: #E6A23C;
}

.usage-tips {
  margin-bottom: 24px;
  padding: 20px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.usage-tips h3 {
  color: #303133;
  margin-bottom: 20px;
}

.tips-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 16px;
}

.tip-card {
  padding: 16px;
  background: #f8f9fa;
  border-radius: 6px;
  border-left: 4px solid #409EFF;
}

.tip-card h4 {
  margin: 0 0 8px 0;
  color: #303133;
  font-size: 14px;
}

.tip-card p {
  margin: 0;
  color: #606266;
  font-size: 13px;
  line-height: 1.4;
}

.debug-info {
  padding: 20px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.debug-info h3 {
  color: #303133;
  margin-bottom: 16px;
}

.debug-content {
  background: #f8f9fa;
  padding: 16px;
  border-radius: 6px;
  font-family: 'Courier New', monospace;
  font-size: 13px;
}

.debug-content pre {
  margin: 8px 0;
  white-space: pre-wrap;
}

/* ç®€å•å›¾æ ‡æ ·å¼ */
.icon-home::before {
  content: 'ğŸ ';
}

.icon-user::before {
  content: 'ğŸ‘¤';
}

.icon-product::before {
  content: 'ğŸ“¦';
}

.icon-order::before {
  content: 'ğŸ“‹';
}

.icon-system::before {
  content: 'âš™ï¸';
}

.icon-data::before {
  content: 'ğŸ“Š';
}

.icon-finance::before {
  content: 'ğŸ’°';
}

.icon-help::before {
  content: 'â“';
}
</style>